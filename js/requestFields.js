var RequestFields=function(e){var t={initialize:function(){var e=void 0==localStorage.getItem("requestFields")?{}:JSON.parse(localStorage.getItem("requestFields"));localStorage.setItem("requestFields",JSON.stringify(e));var t=JSON.parse(localStorage.getItem("releases")),a=Object.keys(t);console.log(a),$("#Fld__xml_Release").autocomplete({source:a});var s=JSON.parse(localStorage.getItem("product-components")),r={};for(var i in s){var o=s[i];r[o.name]=o.path}var l=Object.keys(r);$("#Fld__xml_ProductComponent").autocomplete({source:l}),this.storeBuildData(),this.defaultFieldValues(),this.fillFields(),this.rememberFields(),this.initFieldPopover(),this.initSectionTracking(),this.fieldSetHandler(),this.initFieldEvents()},rememberFields:function(){function e(e){var t=$(e).attr("id"),a=$(e).val(),s=JSON.parse(localStorage.getItem("requestFields"));s[t]=a,localStorage.setItem("requestFields",JSON.stringify(s))}var t=".form-control";$("#request").find(t).each(function(){e(this)}),$("#request").find(t).focusout(function(){e(this)}),$("input:radio").click(function(){var e=$(this).attr("id"),t=JSON.parse(localStorage.getItem("requestFields"));switch(e){case"productLayer":t.Fld__xml_ImpactedLayer=$(this).val();break;case"asLayer":t.Fld__xml_ImpactedLayer=$(this).val();break;default:console.warn("Remembering invalid radio field")}localStorage.setItem("requestFields",JSON.stringify(t))}),$("input:checkbox").click(function(){var e=$(this).attr("id"),t=JSON.parse(localStorage.getItem("requestFields"));t[e]=1==$(this).prop("checked")?ebYes:ebNo,localStorage.setItem("requestFields",JSON.stringify(t))})},fillFields:function(){var e=".form-control",t=JSON.parse(localStorage.getItem("requestFields"));$("#request").find(e).each(function(){var e=$(this).attr("id"),a=t[e];null!=a&&"filename"!=e&&$(this).val(a)}),$("input:radio").each(function(){switch(t.Fld__xml_ImpactedLayer){case impactLayer.product:$("#productLayer").prop("checked",!0);break;case impactLayer.as:$("#asLayer").prop("checked",!0);break;default:t.Fld__xml_ImpactedLayer=impactLayer.product}}),$("input:checkbox").each(function(){var e=$(this).attr("id"),t=JSON.parse(localStorage.getItem("requestFields"));$(this).prop("checked",t[e]==impactLayer.product?!0:!1)}),this.fillImages()},clearFields:function(){var e=".form-control";$("#request").find(e).each(function(){var e=$(this).attr("id");if(["Fld__xml_Type","Fld__xml_Severity","Fld__xml_Priority"].indexOf(e)>-1)switch(e){case"type":$(this).val(type.bug);break;case"severity":$(this).val(severity.minor);break;case"priority":$(this).val(priority.normal)}else $(this).val("")}),$("#productLayer").prop("checked",!0),$("#Fld__xml_Regression").prop("checked",!1),$("#Fld__xml_RegressionFrom").parent().hasClass("hide")||$("#Fld__xml_RegressionFrom").parent().addClass("hide");var t={};localStorage.setItem("requestFields",JSON.stringify(t));var a=new Screenshot;a.clearScreenshots()},defaultFieldValues:function(){var e=JSON.parse(localStorage.getItem("requestFields"));0==Object.keys(e).length&&(e.Fld__xml_ImpactedLayer="2",localStorage.setItem("requestFields",JSON.stringify(e)))},fillImages:function(){var e=JSON.parse(localStorage.getItem("Screenshots"))||{};Object.keys(e).length>2&&$("#"+buttons.screenshot).attr("disabled","disabled"),$.get("screenshotListItem.html",function(t){for(var a in e)if(e.hasOwnProperty(a)){var s=$($(t)[0]).attr("data-screenshot-name",a)[0];s=$(s).append(a),$(".screenshot-group").append(s)}var r=new Screenshot;r.initScreenshotEvents()})},initFieldEvents:function(){$("#"+buttons.request).attr("disabled","disabled"),$("#"+buttons.cancelRequest).click(this.resetSections).click(this.clearFields).click(this.defaultFieldValues),$("#"+buttons.createRequest).click(this.downloadScreenshots).click(this.createRequest).click(this.clearFields).click(this.resetSections),$("#"+buttons.screenshot).click(this.takeScreenshot),$("#"+buttons.request).click(this.storeBuildData).click(this.fieldSetHandler)},fieldSetHandler:function(){$("[data-fieldset]").each(function(){var e=$(this),t=e.find(".form-control").attr("id"),a=$("#"+t).parent(),s=e.data("fieldset");for(var r in s){var i=(s[r],$("#"+r));"checkbox"==i.prop("type")&&(1==i.prop("checked")&&a.removeClass("hide"),$("#"+r).change(function(){1==$(this).prop("checked")&&a.removeClass("hide"),0==$(this).prop("checked")&&a.addClass("hide")}))}})},initFieldPopover:function(){var e=".form-control";$("#request").find(e).hover(function(){var e=$(this).val();if(""!==e){var t=$(this).prev().text();console.log(t),$(this).popover({content:t,placement:"top",container:"body",trigger:"focus"})}else $(this).popover("destroy")})},initSectionTracking:function(){var e=".panel-collapse";this.loadLastSection(),$(e).on("shown.bs.collapse",function(){var e=$(this).attr("id");localStorage.setItem("lastSection",e)})},loadLastSection:function(){var e=localStorage.getItem("lastSection");null!=e?$("#"+e).collapse({parent:"#accordion"}):this.resetSections()},resetSections:function(){$("#collapseOne").addClass("in"),$("#collapseOne").css({height:"auto"}),$("#collapseTwo").removeClass("in"),$("#collapseTwo").css({height:"0px"}),$("#collapseThree").removeClass("in"),$("#collapseThree").css({height:"0px"}),$("#collapseFour").removeClass("in"),$("#collapseFour").css({height:"0px"}),localStorage.setItem("lastSection","collapseOne")},createRequest:function(){var e=new URLManagement,t=e.createRequestURL();this.storeBuildData;var a=JSON.parse(localStorage.getItem("requestFields"));for(var s in a){var r=a[s];if(""!=r&&void 0!=r)if("Fld__xml_ProductComponent"==s){var i=JSON.parse(localStorage.getItem("product-components")),o={};for(var l in i){var n=i[l];o[n.name]=n.path+" > "+n.code}t=t+"&"+s+"="+encodeURIComponent(o[r]||"")}else if("Fld__xml_Release"==s){var c=JSON.parse(localStorage.getItem("releases"));t=t+"&"+s+"="+encodeURIComponent(c[r]||"")}else if("Fld__xml_NeedDate"==s){var d=r.split("-")[1]+"/"+r.split("-")[2]+"/"+r.split("-")[0];t=t+"&"+s+"="+encodeURIComponent(d&&"")}else t=t+"&"+s+"="+encodeURIComponent(r)}chrome.tabs.query({currentWindow:!0,active:!0},function(e){chrome.tabs.create({url:t,index:e[0].index+1,openerTabId:e[0].id})})},storeBuildData:function(){function e(e){console.log("storeBuildDataHelper");var t=JSON.parse(localStorage.getItem("requestFields"));void 0==t.Fld__xml_EnvironmentBuilds&&(t.Fld__xml_EnvironmentBuilds=e.buildData,t.Fld__xml_URL=e.requestURL,$("#Fld__xml_URL").val(e.requestURL),localStorage.setItem("requestFields",JSON.stringify(t)))}var t=new URLManagement;t.getCurrentSiteBuilds(e)},takeScreenshot:function(){var e=new Screenshot;e.takeScreenshot()},downloadScreenshots:function(){var e=new Screenshot;e.downloadScreenshots(),e.clearScreenshots()}};return t.initialize(),t};